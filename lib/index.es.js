import e,{useContext as t,useCallback as r,useMemo as n,useState as o}from"react";import a from"prop-types";import i from"classnames";import l from"@material-ui/core/Paper";import c from"@material-ui/core/Typography";import u from"@material-ui/core/List";import m from"@material-ui/icons/KeyboardArrowUp";import s from"@material-ui/icons/KeyboardArrowDown";import p from"@material-ui/icons/MoreVert";import d from"@material-ui/core/Collapse";import f from"@material-ui/core/ListItem";import g from"@material-ui/core/ListItemIcon";import h from"@material-ui/core/ListItemText";import{makeStyles as y,useTheme as b}from"@material-ui/styles";import v from"@material-ui/core/Button";import E from"@material-ui/core/IconButton";import T from"@material-ui/core/Tooltip";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,o=function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function _slicedToArray(e,t){return function _arrayWithHoles(e){if(Array.isArray(e))return e}(e)||function _iterableToArrayLimit(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw a}}return r}(e,t)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var I=e.createContext({}),x=y(function(e){return{paper:{paddingTop:e.spacing(3),paddingBottom:e.spacing(3)},caption:{fontSize:16,textAlign:"center"},item:{width:"auto",height:32,paddingRight:e.spacing(2)},treeIconContainer:{minWidth:"initial"},treeIcon:{width:16,height:16,marginRight:8},treeIconButton:{color:e.palette.primary.light},treeTextButton:{color:e.palette.primary.light},treeText:{flex:"0 0 auto",paddingLeft:e.spacing(1),paddingRight:e.spacing(3)},treeTextFlex:{flex:1},button:{minWidth:"auto",minHeight:"auto",width:"auto",height:"auto",fontSize:12,lineHeight:1,padding:4},actionIcon:{width:12,height:12}}}),O=function TreeNode(o){var a=x(),l=b(),c=t(I),u=c.foldIcon,m=c.unfoldIcon,s=c.labelKey,p=c.renderLabel,d=c.actionsAlignRight,y=c.getActionsData,O=o.data,j=o.unfoldStatus,A=o.depth,L=o.path,P=o.toggleFoldStatus,C=o.onClick,N=r(function(t){return e.cloneElement(t,{className:a.treeIcon})},[a]),S=r(function(){return p&&"function"==typeof p?p(O,j):O[s]},[p,s,O,j]),w=r(function(e){return function(t){t.preventDefault(),t.stopPropagation(),e()}},[]),R=n(function(){if(y&&"function"==typeof y){var t=[].concat(y(O,L,j,P)||[]);if(t&&t.length)return t.map(function(t,r){var n=t.icon,o=t.label,i=t.hint,c=t.style,u=void 0===c?{}:c,m=t.onClick,s=void 0===m?function(){}:m,p=_objectWithoutProperties(t,["icon","label","hint","style","onClick"]),f=Object.assign({marginLeft:l.spacing(2)},u),g=null;return o?g=e.createElement(v,{size:"small"},n&&e.cloneElement(n,{className:a.actionIcon}),o):n&&(g=e.createElement(E,null,n)),g&&(g=e.cloneElement(g,function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,r[t])})}return e}({color:"primary",className:a.button,style:f,onClick:w(s)},p)),i&&(g=e.createElement(T,{title:i,placement:d?"left":"right"},g))),g&&e.cloneElement(g,{key:"tree-node-".concat(L.join("-"),"-action-").concat(t.id||t.name||t.key||r+1)})})}return null},[y,d,O,L,j,P,l,a,w]);return e.createElement(f,{dense:!0,button:!0,onClick:C,className:a.item,style:{marginLeft:A*l.spacing(3)}},e.createElement(g,{className:a.treeIconContainer},N(j?m:u)),e.createElement(h,{primary:S(),className:i(a.treeText,_defineProperty({},a.treeTextFlex,d))}),R)};O.propTypes={data:a.object.isRequired,unfoldStatus:a.bool.isRequired,depth:a.number.isRequired,path:a.arrayOf(a.number).isRequired,toggleFoldStatus:a.func.isRequired,onClick:a.func.isRequired};var j=function Tree(n){var a=x(),l=b(),c=t(I),u=c.unfoldAll,m=c.unfoldFirst,s=c.valueKey,p=c.childrenKey,y=c.pageSize,v=c.loadMoreIcon,E=c.renderLoadMoreText,T=c.requestChildrenData,j=n.data,A=n.depth,L=n.path,P=_slicedToArray(o(u||0===A&&m),2),C=P[0],N=P[1],S=j[p]||[],w=Math.ceil(S.length/y),R=_slicedToArray(o(0),2),k=R[0],_=R[1],q=r(function(){N(!C)},[C,N]),K=r(function(){var t=(k+1)*y;return S.slice(0,t).map(function(t,r){return e.createElement(Tree,{key:"tree-branch-".concat(t[s]),data:t,depth:A+1,path:L.concat(r)})})},[s,S,k,y,A,L]),M=r(function(t){return e.cloneElement(t,{className:i(a.treeIcon,a.treeIconButton)})},[a]),D=r(function(){_(k+1)},[k,_]),F=r(function(){C?q():S.length>0?q():T&&"function"==typeof T?T(j,L,q):q()},[C,q,S,T,j,L]);return e.createElement(e.Fragment,null,e.createElement(O,{data:j,unfoldStatus:C,depth:A,path:L,toggleFoldStatus:q,onClick:F}),e.createElement(d,{in:C,unmountOnExit:!0},K(),C&&k+1<w&&e.createElement(f,{dense:!0,button:!0,onClick:D,className:a.item,style:{marginLeft:(A+1)*l.spacing(3)}},e.createElement(g,{className:a.treeIconContainer},M(v)),e.createElement(h,{primary:E(k,y,S.length),className:i(a.treeText,a.treeTextButton)}))))};j.propTypes={data:a.object.isRequired,depth:a.number.isRequired,path:a.arrayOf(a.number).isRequired};var A=function MuiTree(t){var r=x(),n=t.className,o=t.title,a=t.data,m=_objectWithoutProperties(t,["className","title","data"]);return e.createElement(l,{className:i(r.paper,n)},o&&e.createElement(c,{variant:"h6",className:r.caption},o),a&&e.createElement(I.Provider,{value:m},e.createElement(u,{dense:!0,component:"div"},e.createElement(j,{data:a,depth:0,path:[]}))))};A.defaultProps={data:{},className:"",title:"",labelKey:"label",valueKey:"value",childrenKey:"children",unfoldFirst:!1,unfoldAll:!1,pageSize:20,foldIcon:e.createElement(m,null),unfoldIcon:e.createElement(s,null),loadMoreIcon:e.createElement(p,null),actionsAlignRight:!1,getActionsData:null,renderLabel:null,renderLoadMoreText:function renderLoadMoreText(e,t,r){return"Loaded pages: ".concat(e+1," / Page size: ").concat(t," / Total: ").concat(r,". Click here to load more...")},requestChildrenData:null},A.propTypes={data:a.object,className:a.string,title:a.oneOfType([a.string,a.node]),labelKey:a.string,valueKey:a.string,childrenKey:a.string,unfoldFirst:a.bool,unfoldAll:a.bool,pageSize:a.number,foldIcon:a.element,unfoldIcon:a.element,loadMoreIcon:a.element,actionsAlignRight:a.bool,getActionsData:a.func,renderLabel:a.func,renderLoadMoreText:a.func,requestChildrenData:a.func};export default A;
