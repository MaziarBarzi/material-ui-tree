import e,{useContext as t,useCallback as r,useMemo as n,useState as o}from"react";import a from"prop-types";import i from"classnames";import l from"@material-ui/core/Paper";import c from"@material-ui/core/Typography";import u from"@material-ui/core/List";import s from"@material-ui/icons/KeyboardArrowUp";import m from"@material-ui/icons/KeyboardArrowDown";import p from"@material-ui/icons/MoreVert";import f from"@material-ui/core/Collapse";import d from"@material-ui/core/ListItem";import y from"@material-ui/core/ListItemIcon";import g from"@material-ui/core/ListItemText";import{makeStyles as h,useTheme as b}from"@material-ui/core/styles";import v from"@material-ui/core/Button";import O from"@material-ui/core/IconButton";import T from"@material-ui/core/Tooltip";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,o=function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function _slicedToArray(e,t){return function _arrayWithHoles(e){if(Array.isArray(e))return e}(e)||function _iterableToArrayLimit(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw a}}return r}(e,t)||function _unsupportedIterableToArray(e,t){if(!e)return;if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}(e,t)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var E=e.createContext({}),j=h((function(e){return{paper:{paddingTop:e.spacing(3),paddingBottom:e.spacing(3)},caption:{fontSize:16,textAlign:"center"},item:{width:"auto",height:32,paddingRight:e.spacing(2)},treeIconContainer:{minWidth:"initial"},treeIcon:{width:16,height:16,marginRight:8},treeIconButton:{color:e.palette.primary.light},treeTextButton:{color:e.palette.primary.light},treeText:{flex:"0 0 auto",paddingLeft:e.spacing(1),paddingRight:e.spacing(3)},treeTextFlex:{flex:1},button:{minWidth:"auto",minHeight:"auto",width:"auto",height:"auto",fontSize:12,lineHeight:1,padding:4},actionIcon:{width:12,height:12}}})),I=function TreeNode(o){var a=j(),l=b(),c=t(E),u=c.foldIcon,s=c.unfoldIcon,m=c.labelKey,p=c.renderLabel,f=c.actionsAlignRight,h=c.getActionsData,I=o.data,A=o.unfoldStatus,w=o.depth,x=o.path,P=o.toggleFoldStatus,S=o.onClick,L=r((function(t){return e.cloneElement(t,{className:a.treeIcon})}),[a]),C=r((function(){return p&&"function"==typeof p?p(I,A):I[m]}),[p,m,I,A]),_=r((function(e){return function(t){t.preventDefault(),t.stopPropagation(),e(t)}}),[]),k=n((function(){if(h&&"function"==typeof h){var t=[].concat(h(I,x,A,P)||[]);if(t&&t.length)return t.map((function(t,r){var n=t.icon,o=t.label,i=t.hint,c=t.style,u=void 0===c?{}:c,s=t.onClick,m=void 0===s?function(){}:s,p=_objectWithoutProperties(t,["icon","label","hint","style","onClick"]),d=Object.assign({marginLeft:l.spacing(2)},u),y=null;return o?y=e.createElement(v,{size:"small"},n&&e.cloneElement(n,{className:a.actionIcon}),o):n&&(y=e.createElement(O,null,n)),y&&(y=e.cloneElement(y,function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({color:"primary",className:a.button,style:d,onClick:_(m)},p)),i&&(y=e.createElement(T,{title:i,placement:f?"left":"right"},y))),y&&e.cloneElement(y,{key:"tree-node-".concat(x.join("-"),"-action-").concat(t.id||t.name||t.key||r+1)})}))}return null}),[h,f,I,x,A,P,l,a,_]);return e.createElement(d,{dense:!0,button:!0,onClick:S,className:a.item,style:{marginLeft:w*l.spacing(3)}},e.createElement(y,{className:a.treeIconContainer},L(A?s:u)),e.createElement(g,{primary:C(),className:i(a.treeText,_defineProperty({},a.treeTextFlex,f))}),k)};I.propTypes={data:a.object.isRequired,unfoldStatus:a.bool.isRequired,depth:a.number.isRequired,path:a.arrayOf(a.number).isRequired,toggleFoldStatus:a.func.isRequired,onClick:a.func.isRequired};var A=function Tree(n){var a=j(),l=b(),c=t(E),u=c.unfoldAll,s=c.unfoldFirst,m=c.valueKey,p=c.childrenKey,h=c.pageSize,v=c.loadMoreIcon,O=c.renderLoadMoreText,T=c.requestChildrenData,A=n.data,w=n.depth,x=n.path,P=_slicedToArray(o(u||0===w&&s),2),S=P[0],L=P[1],C=A[p]||[],_=Math.ceil(C.length/h),k=_slicedToArray(o(0),2),N=k[0],R=k[1],K=r((function(){L(!S)}),[S,L]),q=r((function(){var t=(N+1)*h;return C.slice(0,t).map((function(t,r){return e.createElement(Tree,{key:"tree-branch-".concat(t[m]),data:t,depth:w+1,path:x.concat(r)})}))}),[m,C,N,h,w,x]),D=r((function(t){return e.cloneElement(t,{className:i(a.treeIcon,a.treeIconButton)})}),[a]),M=r((function(){R(N+1)}),[N,R]),F=r((function(){S||C.length>0?K():T&&"function"==typeof T?T(A,x,K):K()}),[S,K,C,T,A,x]);return e.createElement(e.Fragment,null,e.createElement(I,{data:A,unfoldStatus:S,depth:w,path:x,toggleFoldStatus:K,onClick:F}),e.createElement(f,{in:S,unmountOnExit:!0},q(),S&&N+1<_&&e.createElement(d,{dense:!0,button:!0,onClick:M,className:a.item,style:{marginLeft:(w+1)*l.spacing(3)}},e.createElement(y,{className:a.treeIconContainer},D(v)),e.createElement(g,{primary:O(N,h,C.length),className:i(a.treeText,a.treeTextButton)}))))};A.propTypes={data:a.object.isRequired,depth:a.number.isRequired,path:a.arrayOf(a.number).isRequired};var w=function MuiTree(t){var r=j(),n=t.className,o=t.title,a=t.data,s=_objectWithoutProperties(t,["className","title","data"]);return e.createElement(l,{className:i(r.paper,n)},o&&e.createElement(c,{variant:"h6",className:r.caption},o),a&&e.createElement(E.Provider,{value:s},e.createElement(u,{dense:!0,component:"div"},e.createElement(A,{data:a,depth:0,path:[]}))))};w.defaultProps={data:{},className:"",title:"",labelKey:"label",valueKey:"value",childrenKey:"children",unfoldFirst:!1,unfoldAll:!1,pageSize:20,foldIcon:e.createElement(s,null),unfoldIcon:e.createElement(m,null),loadMoreIcon:e.createElement(p,null),actionsAlignRight:!1,getActionsData:null,renderLabel:null,renderLoadMoreText:function renderLoadMoreText(e,t,r){return"Loaded pages: ".concat(e+1," / Page size: ").concat(t," / Total: ").concat(r,". Click here to load more...")},requestChildrenData:null},w.propTypes={data:a.object,className:a.string,title:a.oneOfType([a.string,a.node]),labelKey:a.string,valueKey:a.string,childrenKey:a.string,unfoldFirst:a.bool,unfoldAll:a.bool,pageSize:a.number,foldIcon:a.element,unfoldIcon:a.element,loadMoreIcon:a.element,actionsAlignRight:a.bool,getActionsData:a.func,renderLabel:a.func,renderLoadMoreText:a.func,requestChildrenData:a.func};export default w;
