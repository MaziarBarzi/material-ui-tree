import e,{useContext as t,useCallback as n,useMemo as r,useState as o}from"react";import a from"prop-types";import i from"classnames";import l from"@material-ui/core/Paper";import c from"@material-ui/core/Typography";import u from"@material-ui/core/List";import m from"@material-ui/icons/KeyboardArrowUp";import s from"@material-ui/icons/KeyboardArrowDown";import p from"@material-ui/icons/MoreVert";import f from"@material-ui/core/Collapse";import d from"@material-ui/core/ListItem";import g from"@material-ui/core/ListItemIcon";import h from"@material-ui/core/ListItemText";import{makeStyles as y,useTheme as b}from"@material-ui/styles";import v from"@material-ui/core/Button";import E from"@material-ui/core/IconButton";import I from"@material-ui/core/Tooltip";function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var C=e.createContext({}),w=y(function(e){return{paper:{paddingTop:e.spacing(3),paddingBottom:e.spacing(3)},caption:{fontSize:16,textAlign:"center"},item:{width:"auto",height:32,paddingRight:e.spacing(2)},treeIconContainer:{minWidth:"initial"},treeIcon:{width:16,height:16,marginRight:8},treeIconButton:{color:e.palette.primary.light},treeTextButton:{color:e.palette.primary.light},treeText:{flex:"0 0 auto",paddingLeft:e.spacing(1),paddingRight:e.spacing(3)},treeTextFlex:{flex:1},button:{minWidth:"auto",minHeight:"auto",width:"auto",height:"auto",fontSize:12,lineHeight:1,padding:4},actionIcon:{width:12,height:12}}}),N=function(o){var a=w(),l=b(),c=t(C),u=c.foldIcon,m=c.unfoldIcon,s=c.labelKey,p=c.renderLabel,f=c.actionsAlignRight,y=c.getActionsData,T=o.data,N=o.unfoldStatus,S=o.depth,L=o.path,R=o.toggleFoldStatus,j=o.onClick,k=n(function(t){return e.cloneElement(t,{className:a.treeIcon})},[a]),A=n(function(){return p&&"function"==typeof p?p(T,N):T[s]},[p,s,T,N]),q=n(function(e){return function(t){t.preventDefault(),t.stopPropagation(),e()}},[]),K=r(function(){if(y&&"function"==typeof y){var t=[].concat(y(T,L,N,R)||[]);if(t&&t.length)return t.map(function(t,n){var r=t.icon,o=t.label,i=t.hint,c=t.style,u=void 0===c?{}:c,m=t.onClick,s=void 0===m?function(){}:m,p=O(t,["icon","label","hint","style","onClick"]),d=Object.assign({marginLeft:l.spacing(2)},u),g=null;return o?g=e.createElement(v,{size:"small"},r&&e.cloneElement(r,{className:a.actionIcon}),o):r&&(g=e.createElement(E,null,r)),g&&(g=e.cloneElement(g,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){x(e,t,n[t])})}return e}({color:"primary",className:a.button,style:d,onClick:q(s)},p)),i&&(g=e.createElement(I,{title:i,placement:f?"left":"right"},g))),g&&e.cloneElement(g,{key:"tree-node-".concat(L.join("-"),"-action-").concat(t.id||t.name||t.key||n+1)})})}return null},[y,f,T,L,N,R,l,a,q]);return e.createElement(d,{dense:!0,button:!0,onClick:j,className:a.item,style:{marginLeft:S*l.spacing(3)}},e.createElement(g,{className:a.treeIconContainer},k(N?m:u)),e.createElement(h,{primary:A(),className:i(a.treeText,x({},a.treeTextFlex,f))}),K)};N.propTypes={data:a.object.isRequired,unfoldStatus:a.bool.isRequired,depth:a.number.isRequired,path:a.arrayOf(a.number).isRequired,toggleFoldStatus:a.func.isRequired,onClick:a.func.isRequired};var S=function r(a){var l=w(),c=b(),u=t(C),m=u.unfoldAll,s=u.unfoldFirst,p=u.valueKey,y=u.childrenKey,v=u.pageSize,E=u.loadMoreIcon,I=u.renderLoadMoreText,x=u.requestChildrenData,O=a.data,S=a.depth,L=a.path,R=T(o(m||0===S&&s),2),j=R[0],k=R[1],A=O[y]||[],q=Math.ceil(A.length/v),K=T(o(0),2),P=K[0],D=K[1],F=n(function(){return k(!j)},[j,k]),M=n(function(){var t=(P+1)*v;return A.slice(0,t).map(function(t,n){return e.createElement(r,{key:"tree-branch-".concat(t[p]),data:t,depth:S+1,path:L.concat(n)})})},[p,A,P,v,S,L]),z=n(function(t){return e.cloneElement(t,{className:i(l.treeIcon,l.treeIconButton)})},[l]),B=n(function(){D(P+1)},[P,D]),H=n(function(){j?F():A.length>0?F():x&&"function"==typeof x?x(O,L,F):F()},[j,F,A,x,O,L]);return e.createElement(e.Fragment,null,e.createElement(N,{data:O,unfoldStatus:j,depth:S,path:L,toggleFoldStatus:F,onClick:H}),e.createElement(f,{in:j,unmountOnExit:!0},M(),j&&P+1<q&&e.createElement(d,{dense:!0,button:!0,onClick:B,className:l.item,style:{marginLeft:(S+1)*c.spacing(3)}},e.createElement(g,{className:l.treeIconContainer},z(E)),e.createElement(h,{primary:I(P,v,A.length),className:i(l.treeText,l.treeTextButton)}))))};S.propTypes={data:a.object.isRequired,depth:a.number.isRequired,path:a.arrayOf(a.number).isRequired};var L=function(t){var n=w(),r=t.className,o=t.title,a=t.data,m=O(t,["className","title","data"]);return e.createElement(l,{className:i(n.paper,r)},o&&e.createElement(c,{variant:"h6",className:n.caption},o),a&&e.createElement(C.Provider,{value:m},e.createElement(u,{dense:!0,component:"div"},e.createElement(S,{data:a,depth:0,path:[]}))))};L.defaultProps={data:{},className:"",title:"",labelKey:"label",valueKey:"value",childrenKey:"children",unfoldFirst:!1,unfoldAll:!1,pageSize:20,foldIcon:e.createElement(m,null),unfoldIcon:e.createElement(s,null),loadMoreIcon:e.createElement(p,null),actionsAlignRight:!1,getActionsData:null,renderLabel:null,renderLoadMoreText:function(e,t,n){return"Loaded pages: ".concat(e+1," / Page size: ").concat(t," / Total: ").concat(n,". Click here to load more...")},requestChildrenData:null},L.propTypes={data:a.object,className:a.string,title:a.oneOfType([a.string,a.node]),labelKey:a.string,valueKey:a.string,childrenKey:a.string,unfoldFirst:a.bool,unfoldAll:a.bool,pageSize:a.number,foldIcon:a.element,unfoldIcon:a.element,loadMoreIcon:a.element,actionsAlignRight:a.bool,getActionsData:a.func,renderLabel:a.func,renderLoadMoreText:a.func,requestChildrenData:a.func};export default L;
